/*! portfolio-allocation - v0.0.4 (2017-12-01), Roman Rubsamen <roman.rubsamen@gmail.com> */var PortfolioAllocation=PortfolioAllocation||{};PortfolioAllocation=function(a){function b(a){function c(a){f.nbRows=a.length,f.nbColumns=a[0].length,f.data="function"==typeof Float64Array?new Float64Array(f.nbRows*f.nbColumns):new Array(f.nbRows*f.nbColumns);for(var b=0;b<f.nbRows;++b){if(!(a[b]instanceof Array))throw new Error("unsupported input type");if(a[b].length!==f.nbColumns)throw new Error("unsupported input type");for(var c=0;c<f.nbColumns;++c)f.data[b*f.nbColumns+c]=a[b][c]}return f}function d(a){f.nbRows=a.length,f.nbColumns=1,f.data="function"==typeof Float64Array?new Float64Array(f.nbRows*f.nbColumns):new Array(f.nbRows*f.nbColumns);for(var b=0;b<f.nbRows;++b)f.data[b*f.nbColumns]=a[b];return f}function e(a){f.nbRows=a.nbRows,f.nbColumns=a.nbColumns,f.data="function"==typeof Float64Array?new Float64Array(f.nbRows*f.nbColumns):new Array(f.nbRows*f.nbColumns);for(var b=0;b<f.nbRows;++b)for(var c=0;c<f.nbColumns;++c)f.data[b*f.nbColumns+c]=a.data[b*a.nbColumns+c];return f}var f=this;if(a instanceof Array&&a[0]instanceof Array)return c(a);if(a instanceof Array)return d(a);if(a instanceof b)return e(a);throw new Error("unsupported input type")}function c(a){var c={getCorrelationMatrix:function(){var a=Object.create(b.prototype);a.nbRows=this.nbRows,a.nbColumns=this.nbColumns,a.data="function"==typeof Float64Array?new Float64Array(a.nbRows*a.nbColumns):new Array(a.nbRows*a.nbColumns);for(var c=0;c<a.nbRows;++c){for(var d=Math.sqrt(this.data[c*this.nbColumns+c]),e=0;e<c;++e)a.data[c*a.nbColumns+e]=a.data[e*this.nbColumns+c];for(var e=c;e<a.nbColumns;++e){var f=Math.sqrt(this.data[e*this.nbColumns+e]);a.data[c*a.nbColumns+e]=this.data[c*this.nbColumns+e]/(d*f)}}return a},getVariancesVector:function(){return this.diagonal()},standardizedGeneralizedVariance:function(){var a=this.determinant();if(a<0)throw new Error("covariance matrix is not positive semi-definite");var b=Math.pow(a,1/this.nbRows);return b}};for(var d in c)a[d]=c[d]}function d(a,b){this.n=a,this.k=b,this.mtc=!1,this.r=new Array(b),this.t=this.n,this.h=0,this.next=function(){if(this.mtc)this.t>1&&(this.h=0),this.h++,this.t=this.r[this.h-1],this.r[this.h-1]=0,this.r[0]=this.t-1,this.r[this.h]++;else{this.r[0]=this.n;for(var a=1;a<=this.k-1;++a)this.r[a]=0}return this.mtc=this.r[this.k-1]!=this.n,[this.mtc,this.r.slice()]}}function e(a){this.n=a,this.mtc=!1,this.iin=new Array(a),this.ncard=0,this.next=function(){var a=[];if(this.mtc){var b=0;if(this.ncard%2!=0)for(b++;0==this.iin[b-1];)b++;this.iin[b]=1-this.iin[b],this.ncard=this.ncard+2*this.iin[b]-1,a=new Array(this.ncard);for(var c=0,d=0;d<=this.n-1;++d)1==this.iin[d]&&(a[c++]=d+1);this.mtc=this.ncard!=this.iin[this.n-1]}else{for(var d=0;d<=this.n-1;++d)this.iin[d]=0;this.mtc=!0}return[this.mtc,a]}}function f(a,b){if(a<0)throw new Error("n must be a positive integer");if(b<0)throw new Error("k must be a positive integer");if(b>a)throw new Error("k must be less than or equal to n");for(var c=1,d=1;d<=b;++d)c*=a+1-d,c/=d;return c}function g(a,b){var c=0,d=Math.abs(a),e=Math.abs(b);return d>e?(c=b/a,c=d*Math.sqrt(1+c*c)):0!=b?(c=a/b,c=e*Math.sqrt(1+c*c)):c=0,c}function h(a,b){for(var c=new Array(a.length),d=0;d<a.length;++d)c[d]=[a[d],d];0==b?c.sort(function(a,b){return a[0]>b[0]?-1:1}):1==b&&c.sort(function(a,b){return a[0]<b[0]?-1:1});var e=new Array(a.length);e[c[0][1]]=1;for(var d=1;d<a.length;++d)c[d][0]==c[d-1][0]?e[c[d][1]]=e[c[d-1][1]]:e[c[d][1]]=d+1;return e}function i(a,b){var b=b;void 0===b&&(b=.5);for(var c=[],d=a.nbRows,e=new Array(d),f=0;f<e.length;++f)e[f]=f+1;for(;0!=e.length;){if(1===e.length){var g=[e[0]];e[0]=null,c.push(g)}else{for(var h=a.getSubmatrix(e,e),i=h.toDoubleArray(function(a,b,c){return a!=b}),k=new Array(e),f=0;f<e.length;++f)k[f]=j(i[f]);for(var l=0,m=-1,n=-1,o=0,p=-1,q=1,f=0;f<e.length;++f)k[f]>=n&&(l=e[f],m=f,n=k[f]),k[f]<=q&&(o=e[f],p=f,q=k[f]);if(a.getValueAt(l,o)>b){var r=l===o?[l]:[l,o];e[m]=null,e[p]=null;for(var f=0;f<e.length;++f)if(null!==e[f]){var s=(a.getValueAt(e[f],l)+a.getValueAt(e[f],o))/2;s>b&&(r.push(e[f]),e[f]=null)}c.push(r)}else{var t=[l];e[m]=null;for(var f=0;f<e.length;++f)null!==e[f]&&a.getValueAt(e[f],l)>b&&(t.push(e[f]),e[f]=null);if(c.push(t),l!==o){var u=[o];e[p]=null;for(var f=0;f<e.length;++f)null!==e[f]&&a.getValueAt(e[f],o)>b&&(u.push(e[f]),e[f]=null);c.push(u)}}}for(var v=[],f=0;f<e.length;++f)null!==e[f]&&v.push(e[f]);e=v}return c}function j(a){for(var b=a.length,c=0,d=0,e=0;e<b;++e)d+=a[e];c=d/b;for(var f=0,e=0;e<b;++e)f+=a[e]-c;return(d+f)/b}function k(a){for(var b=a.length,c=j(a),d=0,e=0,f=0;f<b;++f){var g=a[f]-c;d+=g*g,e+=g}var h=d-e*e/b;return h/b}function l(a){var b=a.length;return k(a)*b/(b-1)}function m(a){return Math.sqrt(l(a))}function n(a){for(var b=a,c=0,d=a,e=a*a,f=1;b!=c;)b=(c=b)+(d*=e/(f+=2));return.5+b*Math.exp(-.5*e-.9189385332046728)}function o(a,b){for(var c=a.length,d=j(a),e=j(b),f=0,g=0,h=0,i=0;i<c;++i){var k=a[i]-d,l=b[i]-e;f+=k*l,g+=k,h+=l}var m=f-g*h/c;return m/c}function p(a,b){var c=a.length;return o(a,b)*c/(c-1)}function q(a,b,c){var e=Number.MAX_VALUE,f=[],g=new d(c,b);do{for(var h=g.next(),i=h[1],j=0;j<i.length;++j)i[j]=i[j]/c;var k=a(i);k<e?(e=k,f=[i]):k==e&&f.push(i)}while(h[0]);return f}function r(a,b){for(var c=b,d=new Array(a.length),e=0;e<a.length;++e){var f=b*a[e],g=Math.floor(f),h=f-g;c-=g,d[e]=[g,h,e]}d.sort(function(a,b){return b[1]-a[1]});for(var i=new Array(a.length),e=0;e<c;++e){var j=d[e][2];i[j]=(d[e][0]+1)/b}for(var e=c;e<d.length;++e){var j=d[e][2];i[j]=d[e][0]/b}return i}return a.Matrix=b,b.prototype={constructor:b,toString:function(){for(var a=0,b=0;b<this.nbRows;++b)for(var c=0;c<this.nbColumns;++c){var d=String(this.data[b*this.nbColumns+c]).length;d>a&&(a=d)}for(var e=[],b=0;b<this.nbRows;++b){e.push("[ ");for(var c=0;c<this.nbColumns;++c){var f=String(this.data[b*this.nbColumns+c]);e.push(new Array(a-f.length+1).join(" ")+f+" ")}e.push("]\n")}return e.join("")},toDoubleArray:function(a){a=a||function(a,b,c){return!0};for(var b=new Array(this.nbRows),c=0;c<this.nbRows;++c){b[c]=new Array(this.nbColumns);for(var d=0,e=0;e<this.nbColumns;++e){var f=this.data[c*this.nbColumns+e];a(c+1,e+1,f)&&(b[c][d++]=f)}b[c].length=d}return b},toArray:function(a){a=a||function(a,b,c){return!0};for(var b=new Array(this.nbRows*this.nbColumns),c=0,d=0;d<this.nbRows;++d)for(var e=0;e<this.nbColumns;++e){var f=this.data[d*this.nbColumns+e];a(d+1,e+1,f)&&(b[c++]=f)}return b.length=c,b},setValueAt:function(a,b,c){if(a<1||b<1||a>this.nbRows||b>this.nbColumns)throw new Error("index out of bounds when setting matrix value, ("+a+","+b+") in size ("+this.nbRows+","+this.nbColumns+")");return this.data[(a-1)*this.nbColumns+(b-1)]=c,this},getValueAt:function(a,b){if(a<1||b<1||a>this.nbRows||b>this.nbColumns)throw new Error("index out of bounds when getting matrix value, ("+a+","+b+") in size ("+this.nbRows+","+this.nbColumns+")");return this.data[(a-1)*this.nbColumns+(b-1)]},isSquare:function(){return this.nbRows===this.nbColumns},isVector:function(){return 1===this.nbColumns},sum:function(){for(var a=0,b=0;b<this.nbRows;++b)for(var c=0;c<this.nbColumns;++c)a+=this.data[b*this.nbColumns+c];return a},normalize:function(){var a=Object.create(b.prototype);a.nbRows=this.nbRows,a.nbColumns=this.nbColumns,a.data="function"==typeof Float64Array?new Float64Array(a.nbRows*a.nbColumns):new Array(a.nbRows*a.nbColumns);var c=this.sum();if(0===c)throw new Error("sum of coefficients of matrix is null");for(var d=0;d<a.nbRows;++d)for(var e=0;e<a.nbColumns;++e)a.data[d*a.nbColumns+e]=this.data[d*this.nbColumns+e]/c;return a},diagonal:function(){if(!this.isSquare())throw new Error("matrix is not square: ("+this.nbRows+","+this.nbColumns+")");var a=Object.create(b.prototype);a.nbRows=this.nbRows,a.nbColumns=1,a.data="function"==typeof Float64Array?new Float64Array(a.nbRows*a.nbColumns):new Array(a.nbRows*a.nbColumns);for(var c=0;c<this.nbRows;++c)a.data[c]=this.data[c*(this.nbColumns+1)];return a},getRow:function(a){if(a<1||a>this.nbRows)throw new Error("index out of bounds when getting matrix row, ("+a+") in size ("+this.nbRows+","+this.nbColumns+")");var c=Object.create(b.prototype);c.nbRows=this.nbColumns,c.nbColumns=1,c.data="function"==typeof Float64Array?new Float64Array(c.nbRows*c.nbColumns):new Array(c.nbRows*c.nbColumns);for(var d=0;d<this.nbColumns;++d)c.data[d]=this.data[(a-1)*this.nbColumns+d];return c},elemMap:function(a){var c=Object.create(b.prototype);c.nbRows=this.nbRows,c.nbColumns=this.nbColumns,c.data="function"==typeof Float64Array?new Float64Array(c.nbRows*c.nbColumns):new Array(c.nbRows*c.nbColumns);for(var d=0;d<c.nbRows;++d)for(var e=0;e<c.nbColumns;++e)c.data[d*c.nbColumns+e]=a(d+1,e+1,this.data[d*this.nbColumns+e]);return c},getSubmatrix:function(a,b){if(!(a instanceof Array)||0==a.length)throw new Error("first parameter must be a non empty array");if(!(b instanceof Array)||0==b.length)throw new Error("second parameter must be a non empty array");for(var c=1;c<a.length;++c)if(a[c-1]>=a[c])throw new Error("first parameter must be a sorted array");for(var d=1;d<b.length;++d)if(b[d-1]>=a[d])throw new Error("second parameter must be a sorted array");var e=Object.create(this);e.nbRows=a.length,e.nbColumns=b.length,e.data="function"==typeof Float64Array?new Float64Array(e.nbRows*e.nbColumns):new Array(e.nbRows*e.nbColumns);for(var c=0;c<e.nbRows;++c)for(var f=a[c]-1,d=0;d<e.nbColumns;++d){var g=b[d]-1;e.data[c*e.nbColumns+d]=this.data[f*this.nbColumns+g]}return e},transpose:function(){var a=Object.create(this);a.nbRows=this.nbColumns,a.nbColumns=this.nbRows,a.data="function"==typeof Float64Array?new Float64Array(a.nbRows*a.nbColumns):new Array(a.nbRows*a.nbColumns);for(var b=0;b<a.nbRows;++b)for(var c=0;c<a.nbColumns;++c)a.data[b*a.nbColumns+c]=this.data[c*this.nbColumns+b];return a},determinant:function(){if(!this.isSquare())throw new Error("matrix is not square: ("+this.nbRows+","+this.nbColumns+")");for(var a=b.qrDecomposition(this),c=a[1],d=1,e=0;e<c.nbRows;++e)d*=c.data[e*c.nbColumns+e];return d},matrixNorm:function(a){if("one"==a){for(var b=0,c=0;c<this.nbColumns;++c){for(var d=0,e=0;e<this.nbRows;++e)d+=Math.abs(this.data[e*this.nbColumns+c]);b=Math.max(b,d)}return b}if("infinity"==a){for(var f=0,e=0;e<this.nbRows;++e){for(var g=0,c=0;c<this.nbColumns;++c)g+=Math.abs(this.data[e*this.nbColumns+c]);f=Math.max(f,g)}return f}if("frobenius"==a)return this.vectorNorm("two");throw new Error("unsupported matrix norm: "+a)},vectorNorm:function(a){if("one"==a){for(var b=0,c=0;c<this.nbRows;++c)for(var d=0;d<this.nbColumns;++d)b+=Math.abs(this.data[c*this.nbColumns+d]);return b}if("two"==a){for(var e=0,f=1,c=0;c<this.nbRows;++c)for(var d=0;d<this.nbColumns;++d){var g=this.data[c*this.nbColumns+d],h=Math.abs(g);h>e?(f=1+f*(e/g)*(e/g),e=h):f+=g/e*(g/e)}return e*Math.sqrt(f)}if("infinity"==a){for(var i=0,c=0;c<this.nbRows;++c)for(var d=0;d<this.nbColumns;++d)i=Math.max(i,Math.abs(this.data[c*this.nbColumns+d]));return i}throw new Error("unsupported vector norm: "+a)},rowVectorNorm:function(a,b){if(a<1||a>this.nbRows)throw new Error("index out of bounds when getting matrix row, ("+a+") in size ("+this.nbRows+","+this.nbColumns+")");if("one"==b){for(var c=0,d=0;d<this.nbColumns;++d)c+=Math.abs(this.data[(a-1)*this.nbColumns+d]);return c}if("two"==b){for(var e=0,f=1,d=0;d<this.nbColumns;++d){var g=this.data[(a-1)*this.nbColumns+d],h=Math.abs(g);h>e?(f=1+f*(e/g)*(e/g),e=h):f+=g/e*(g/e)}return e*Math.sqrt(f)}if("infinity"==b){for(var i=0,d=0;d<this.nbColumns;++d)i=Math.max(i,Math.abs(this.data[(a-1)*this.nbColumns+d]));return i}throw new Error("unsupported vector norm: "+b)}},b.areEqual=function(a,c,d){if(!(a instanceof b))throw new Error("a must be a matrix");if(!(c instanceof b))throw new Error("b must be a matrix");if(a.nbRows!==c.nbRows)return!1;if(a.nbColumns!==c.nbColumns)return!1;for(var e=a.nbRows,f=a.nbColumns,g=d||0,h=0;h<e;++h)for(var i=0;i<f;++i)if(Math.abs(a.data[h*e+i]-c.data[h*e+i])>g)return!1;return!0},b.axpy=function(a,c,d,e){if(!(c instanceof b))throw new Error("x must be a matrix");if(!(d instanceof b))throw new Error("y must be a matrix");if(c.nbColumns!==d.nbColumns||c.nbRows!==d.nbRows)throw new Error("Matrices sizes do not match: ("+c.nbRows+","+c.nbColumns+") - ("+d.nbRows+","+d.nbColumns+")");var f;if(e){if(!(e instanceof b))throw new Error("the provided output is not a matrix");if(e.nbRows!==c.nbRows||e.nbColumns!==c.nbColumns)throw new Error("the provided output matrix size does not match: ("+e.nbRows+","+e.nbColumns+") - ("+c.nbRows+","+c.nbColumns+")");f=e}else f=Object.create(b.prototype),f.nbRows=c.nbRows,f.nbColumns=c.nbColumns,f.data="function"==typeof Float64Array?new Float64Array(f.nbRows*f.nbColumns):new Array(f.nbRows*f.nbColumns);for(var g=0;g<f.nbRows;++g)for(var h=0;h<f.nbColumns;++h)f.data[g*f.nbColumns+h]=a*c.data[g*c.nbColumns+h]+d.data[g*d.nbColumns+h];return f},b.copy=function(a,c){if(!(a instanceof b))throw new Error("x must be a matrix");if(c){if(c instanceof b){if(c.nbRows!==a.nbRows||c.nbColumns!==a.nbColumns)throw new Error("the provided output matrix size does not match: ("+c.nbRows+","+c.nbColumns+") - ("+a.nbRows+","+a.nbColumns+")");for(var d=0;d<c.nbRows;++d)for(var e=0;e<c.nbColumns;++e)c.data[d*c.nbColumns+e]=a.data[d*a.nbColumns+e];return c}throw new Error("the provided output is not a matrix")}return new b(a)},b.product=function(a,c){if(!(a instanceof b))throw new Error("a must be a matrix");if(!(c instanceof b))throw new Error("b must be a matrix");if(a.nbColumns!==c.nbRows)throw new Error("Matrices sizes do not match: ("+a.nbRows+","+a.nbColumns+") - ("+c.nbRows+","+c.nbColumns+")");var d=Object.create(b.prototype);d.nbRows=a.nbRows,d.nbColumns=c.nbColumns,d.data="function"==typeof Float64Array?new Float64Array(d.nbRows*d.nbColumns):new Array(d.nbRows*d.nbColumns);for(var e=0;e<a.nbRows;++e){for(var f=0;f<c.nbColumns;++f)d.data[e*d.nbColumns+f]=0;for(var g=0;g<a.nbColumns;++g)for(var h=a.data[e*a.nbColumns+g],f=0;f<c.nbColumns;++f)d.data[e*d.nbColumns+f]+=h*c.data[g*c.nbColumns+f]}return d},b.rowColumnProduct=function(a,c,d,e){if(!(a instanceof b))throw new Error("a must be a matrix");if(!(d instanceof b))throw new Error("b must be a matrix");if(a.nbColumns!==d.nbRows)throw new Error("Matrices sizes do not match: ("+a.nbRows+","+a.nbColumns+") - ("+d.nbRows+","+d.nbColumns+")");if(c<1||c>a.nbRows)throw new Error("index out of bounds when getting matrix row, ("+c+") in size ("+a.nbRows+","+a.nbColumns+")");if(e<1||e>d.nbRows)throw new Error("index out of bounds when getting matrix column, ("+e+") in size ("+d.nbRows+","+d.nbColumns+")");for(var f=0,g=0;g<a.nbColumns;++g)f+=a.data[(c-1)*a.nbColumns+g]*d.data[g*d.nbColumns+(e-1)];return f},b.diagonal=function(a){if(!(a instanceof Array))throw new Error("arr must be an array");var c=Object.create(b.prototype);c.nbRows=a.length,c.nbColumns=a.length,c.data="function"==typeof Float64Array?new Float64Array(c.nbRows*c.nbColumns):new Array(c.nbRows*c.nbColumns);for(var d=0;d<c.nbRows;++d){for(var e=0;e<c.nbColumns;++e)c.data[d*c.nbColumns+e]=0;c.data[d*(c.nbColumns+1)]=a[d]}return c},b.fillSymetric=function(a,c){var d=Object.create(b.prototype);d.nbRows=a,d.nbColumns=a,d.data="function"==typeof Float64Array?new Float64Array(d.nbRows*d.nbColumns):new Array(d.nbRows*d.nbColumns);for(var e=0;e<d.nbRows;++e){for(var f=0;f<e;++f)d.data[e*d.nbColumns+f]=d.data[f*d.nbColumns+e];for(var f=e;f<d.nbColumns;++f)d.data[e*d.nbColumns+f]=c(e+1,f+1)}return d},b.zeros=function(a,c){if(a<1)throw new Error("input number of rows out of bounds: "+a);if(c<1)throw new Error("input number of columns out of bounds: "+c);var d=Object.create(b.prototype);d.nbRows=a,d.nbColumns=c,d.data="function"==typeof Float64Array?new Float64Array(d.nbRows*d.nbColumns):new Array(d.nbRows*d.nbColumns);for(var e=0;e<d.nbRows;++e)for(var f=0;f<d.nbColumns;++f)d.data[e*d.nbColumns+f]=0;return d},b.ones=function(a,c){if(a<1)throw new Error("input number of rows out of bounds: "+a);if(c<1)throw new Error("input number of columns out of bounds: "+c);var d=Object.create(b.prototype);d.nbRows=a,d.nbColumns=c,d.data="function"==typeof Float64Array?new Float64Array(d.nbRows*d.nbColumns):new Array(d.nbRows*d.nbColumns);for(var e=0;e<d.nbRows;++e)for(var f=0;f<d.nbColumns;++f)d.data[e*d.nbColumns+f]=1;return d},b.eye=function(a){if(a<1)throw new Error("input number of rows/columns out of bounds: "+a);var c=Object.create(b.prototype);c.nbRows=a,c.nbColumns=a,c.data="function"==typeof Float64Array?new Float64Array(c.nbRows*c.nbColumns):new Array(c.nbRows*c.nbColumns);for(var d=0;d<c.nbRows;++d){for(var e=0;e<d;++e)c.data[d*c.nbColumns+e]=0;c.data[d*c.nbColumns+d]=1;for(var e=d+1;e<c.nbColumns;++e)c.data[d*c.nbColumns+e]=0}return c},b.vectorHadamardProduct=function(a,c){if(!a.isVector())throw new Error("first argument must be a vector");if(!c.isVector())throw new Error("second argument must be a vector");if(a.nbRows!==c.nbRows)throw new Error("Vectors sizes do not match: ("+a.nbRows+") - ("+c.nbRows+")");var d=Object.create(b.prototype);d.nbRows=a.nbRows,d.nbColumns=1,d.data="function"==typeof Float64Array?new Float64Array(d.nbRows*d.nbColumns):new Array(d.nbRows*d.nbColumns);for(var e=0;e<a.nbRows;++e)for(var f=0;f<c.nbRows;++f)d.data[e]=a.data[e]*c.data[e];return d},b.vectorDotProduct=function(a,b){if(!a.isVector())throw new Error("first argument must be a vector");if(!b.isVector())throw new Error("second argument must be a vector");if(a.nbRows!==b.nbRows)throw new Error("Vectors sizes do not match: ("+a.nbRows+") - ("+b.nbRows+")");for(var c=0,d=0;d<a.nbRows;++d)c+=a.data[d]*b.data[d];return c},b.qrDecomposition=function(a){function c(a,b){var c=NaN,d=NaN,e=NaN;if(0==b)c=a>=0?1:-1,d=0,e=Math.abs(a);else if(0==a)c=0,d=b>=0?1:-1,e=Math.abs(b);else if(Math.abs(a)>Math.abs(b)){var f=b/a,g=(a>=0?1:-1)*Math.sqrt(1+f*f);c=1/g,d=f*c,e=a*g}else{var f=a/b,g=(b>=0?1:-1)*Math.sqrt(1+f*f);d=1/g,c=f*d,e=b*g}return[c,-d,e]}var d=a.nbRows,e=a.nbColumns;if(d<e)throw new Error("matrix has more columns than rows: ("+d+") v.s. ("+e+")");for(var f=new b(a),g=b.eye(d),h=1;h<=e;++h)for(var i=d;i>=h+1;--i){var a=f.data[(i-2)*f.nbColumns+(h-1)],j=f.data[(i-1)*f.nbColumns+(h-1)],k=c(a,j),l=k[0],m=k[1],n=k[2];f.data[(i-2)*f.nbColumns+(h-1)]=n,f.data[(i-1)*f.nbColumns+(h-1)]=0;for(var o=h+1;o<=e;++o){var p=f.data[(i-2)*f.nbColumns+(o-1)],q=f.data[(i-1)*f.nbColumns+(o-1)];f.data[(i-2)*f.nbColumns+(o-1)]=l*p-m*q,f.data[(i-1)*f.nbColumns+(o-1)]=m*p+l*q}for(var o=1;o<=d;++o){var p=g.data[(o-1)*g.nbColumns+(i-2)],q=g.data[(o-1)*g.nbColumns+(i-1)];g.data[(o-1)*g.nbColumns+(i-2)]=l*p-m*q,g.data[(o-1)*g.nbColumns+(i-1)]=m*p+l*q}}return[g,f]},b.linsolveKaczmarz=function(a,c,d){void 0===d&&(d={});var e=d.eps||1e-16,f=d.maxIter||1e4;if(!(a instanceof b))throw new Error("a must be a matrix");if(!(c instanceof b))throw new Error("b must be a matrix");if(a.nbColumns!==c.nbRows)throw new Error("Matrices sizes do not match: ("+a.nbRows+","+a.nbColumns+") - ("+c.nbRows+","+c.nbColumns+")");if(1!==c.nbColumns)throw new Error("b is not a vector: ("+c.nbRows+","+c.nbColumns+")");var g=a.nbRows,h=a.nbColumns,i=new b.zeros(h,1),j=new b.zeros(h,1);if(g<h)throw new Error("matrix has more columns than rows: ("+g+") v.s. ("+h+")");for(var k=new Array(g),l=1;l<=g;++l){var m=a.rowVectorNorm(l,"two");k[l-1]=m*m}for(var n=0,o=!1,p=new b.zeros(h,1);!o;){for(var l=1;l<=g;++l)for(var q=c.data[(l-1)*c.nbColumns]-b.rowColumnProduct(a,l,j,1),r=1;r<=h;++r)j.data[(r-1)*j.nbColumns]+=q/k[l-1]*a.data[(l-1)*a.nbColumns+(r-1)];p=b.axpy(-1,i,j,p);var s=p.vectorNorm("infinity"),t=j.vectorNorm("infinity");if(s<=e&&s<=e*t&&(o=!0),i=b.copy(j,i),++n,n>f)throw new Error("maximum number of iterations reached: "+f)}return j},a.covarianceMatrix=function(a){var d=arguments,e=Object.create(b.prototype);e.nbRows=d.length,e.nbColumns=d.length,e.data="function"==typeof Float64Array?new Float64Array(e.nbRows*e.nbColumns):new Array(e.nbRows*e.nbColumns);for(var f=0;f<e.nbRows;++f){for(var g=0;g<f;++g)e.data[f*e.nbColumns+g]=e.data[g*e.nbColumns+f];for(var g=f;g<e.nbColumns;++g)e.data[f*e.nbColumns+g]=o(d[f],d[g])}return c(e),e},a.sampleCovarianceMatrix=function(a){var d=arguments,e=Object.create(b.prototype);e.nbRows=d.length,e.nbColumns=d.length,e.data="function"==typeof Float64Array?new Float64Array(e.nbRows*e.nbColumns):new Array(e.nbRows*e.nbColumns);for(var f=0;f<e.nbRows;++f){for(var g=0;g<f;++g)e.data[f*e.nbColumns+g]=e.data[g*e.nbColumns+f];for(var g=f;g<e.nbColumns;++g)e.data[f*e.nbColumns+g]=p(d[f],d[g])}return c(e),e},b.prototype.toCovarianceMatrix=function(){new b(this);return c(this),this},a.compositionsIterator_=d,a.subsetsIterator_=e,a.binomial_=function(a,b){return f(a,b)},a.hypot_=function(a,b){return g(a,b)},a.rank_=function(a,b){return h(a,b)},a.ftca_=function(a,b){return i(a,b)},a.simplexRationalGirdSearch_=function(a,b,c){return q(a,b,c)},a.simplexRationalRounding_=function(a,b){return r(a,b)},a.clusterRiskParityWeights=function(c,d){void 0===d&&(d={});var e=d.clusteringMode||"ftca",c=new b(c).toCovarianceMatrix(),f=c.nbRows,g=[];if("manual"===e){g=d.clusters||[];for(var h=new Array(f),j=0;j<h.length;++j)h[j]=0;for(var k=0;k<g.length;++k){if(0===g[k].length)throw new Error("empty cluster at index: "+k);for(var l=0;l<g[k].length;++l){var m=g[k][l];if(m<1||m>f)throw new Error("asset index out of bounds: "+m);h[m-1]++}}for(var j=0;j<h.length;++j)if(1!==h[j])throw 0===h[j]?new Error("missing asset index: "+(j+1)):h[j]>1?new Error("duplicate asset index: "+(j+1)):new Error("unknown error")}else{if("ftca"!==e)throw new Error("unsupported clustering method");var n=c.getCorrelationMatrix();g=i(n,d.ftcaThreshold)}for(var o=g.length,p=b.zeros(o,f),j=0;j<o;++j)for(var q=g[j].slice().sort(function(a,b){return a-b}),r=c.getSubmatrix(q,q),s=a.equalRiskContributionWeights(r,d),k=0;k<s.length;++k)p.setValueAt(j+1,q[k],s[k]);var t=b.product(p,b.product(c,p.transpose())),u=a.equalRiskContributionWeights(t,d),v=b.product(p.transpose(),new b(u));return v.toArray()},a.equalRiskBoundingWeights=function(c,d){void 0===d&&(d={});var c=(d.eps||1e-8,d.maxIter||1e4,new b(c)),f=c.nbRows,g=Number.MAX_VALUE,h=[],i=[],j=new e(f),k=j.next();do{var k=j.next(),l=k[1],m=c.getSubmatrix(l,l),n=a.equalRiskContributionWeights(m,d);assetsWeightsMatrix=new b(n);var o=assetsWeightsMatrix.getValueAt(1,1)*b.product(m,assetsWeightsMatrix).getValueAt(1,1);o<g&&(g=o,h=l,i=n)}while(k[0]);for(var p=b.zeros(f,1),q=0;q<h.length;++q)p.setValueAt(h[q],1,i[q]);return p.toArray()},a.equalRiskBudgetWeights=function(a,c){var d=new b(a).elemMap(function(a,b,c){return 1/Math.sqrt(c)}).normalize();return d.toArray()},a.equalRiskContributionWeights=function(c,d){var c=new b(c),e=c.nbRows,f=b.ones(e,1).normalize();return a.riskBudgetingWeights(c,f,d)},a.equalWeights=function(a,c){var d=b.ones(a,1).normalize();return d.toArray()},a.globalMinimumVarianceWeights=function(a,c){void 0===c&&(c={});for(var d=c.eps||1e-8,e=c.maxIter||1e4,a=new b(a),f=a.nbRows,g=b.ones(f,1).normalize(),h=b.product(a,g),i=b.vectorDotProduct(h,g),j=.5*i-g.sum(),k=0,l=!1;!l;){l=!0;for(var m=1;m<=f;++m){var n=a.getValueAt(m,m),o=h.getValueAt(m,1)-g.getValueAt(m,1)*a.getValueAt(m,m)-1,p=o/2,q=p>=0?1:-1,r=-(p+q*Math.abs(p)),s=r/n,t=0;g.setValueAt(m,1,t),h=b.product(a,g),i=b.vectorDotProduct(h,g);var u=.5*i-g.sum();if(s>0){var v=s;g.setValueAt(m,1,v);var w=b.product(a,g),x=b.vectorDotProduct(w,g),y=.5*x-g.sum();y<u?(h=w,i=x,u=y):g.setValueAt(m,1,t)}}if(Math.abs(u-j)>d&&(l=!1,j=u),++k,k>e)throw new Error("maximum number of iterations reached: "+e)}return g=g.normalize(),g.toArray()},a.gridSearchWeights=function(a,b,c){if(void 0===c&&(c={}),c.optimisationMethod=c.optimisationMethod||"deterministic","deterministic"===c.optimisationMethod){c.rationalGrid=c.rationalGrid||{k:a};var d=c.rationalGrid.k;return q(b,a,d)}throw new Error("unsupported optimisation method")},a.minCorrWeights=function(c,d){var c=new b(c).toCovarianceMatrix(),e=c.getVariancesVector(),f=e.elemMap(function(a,b,c){return 1/Math.sqrt(c)}),g=c.getCorrelationMatrix(),i=g.nbRows;if(i<=2)return a.equalRiskBudgetWeights(e,d);for(var k=g.toArray(function(a,b,c){return b>a}),l=j(k),o=m(k),p=g.elemMap(function(a,b,c){return a==b?0:1-n((c-l)/o)}),q=p.toDoubleArray(function(a,b,c){return a!=b}),r=new Array(i),s=0;s<i;++s)r[s]=j(q[s]);var t=h(r,0),u=new b(t,1).normalize();return u=b.product(p,u).normalize(),u=b.vectorHadamardProduct(u,f).normalize(),u.toArray()},a.mostDiversifiedWeights=function(a,c){void 0===c&&(c={});for(var d=c.eps||1e-8,e=c.maxIter||1e4,a=new b(a),f=a.diagonal().elemMap(function(a,b,c){return Math.sqrt(c)}),g=a.nbRows,h=b.ones(g,1).normalize(),i=b.product(a,h),j=Math.sqrt(b.vectorDotProduct(i,h)),k=b.vectorDotProduct(f,h)/j,l=0,m=!1;!m;){m=!0;for(var n=1;n<=g;++n){var o=a.getValueAt(n,n),p=i.getValueAt(n,1)-h.getValueAt(n,1)*a.getValueAt(n,n)-f.getValueAt(n,1),q=p/2,r=q>=0?1:-1,s=-(q+r*Math.abs(q)),t=s/o,u=0;h.setValueAt(n,1,u),i=b.product(a,h),j=Math.sqrt(b.vectorDotProduct(i,h));var v=b.vectorDotProduct(f,h)/j;if(t>0){var w=t;h.setValueAt(n,1,w);var x=b.product(a,h),y=Math.sqrt(b.vectorDotProduct(x,h)),z=b.vectorDotProduct(f,h)/y;z>v?(i=x,j=y,v=z):h.setValueAt(n,1,u)}}if(Math.abs(v-k)>d&&(m=!1,k=v),++l,l>e)throw new Error("maximum number of iterations reached: "+e)}return h=h.normalize(),h.toArray()},a.minVarWeights=function(a,c){for(var a=new b(a),d=a.nbRows,e=a.toDoubleArray(),f=new Array(d),g=0;g<d;++g)f[g]=j(e[g]);var h=j(f),i=m(f),k=new b(f,1).elemMap(function(a,b,c){return 1-n((c-h)/i)}).normalize(),l=a.diagonal().elemMap(function(a,b,c){return 1/c}).normalize();return k=b.vectorHadamardProduct(k,l).normalize(),k.toArray()},a.riskBudgetingWeights=function(a,c,d){void 0===d&&(d={});for(var e=d.eps||1e-8,f=d.maxIter||1e4,a=new b(a),c=new b(c),g=a.nbRows,h=b.ones(g,1).normalize(),i=b.product(a,h),j=Math.sqrt(b.vectorDotProduct(i,h)),k=0,l=!1;!l;){l=!0;for(var m=1;m<=g;++m){var n=a.getValueAt(m,m),o=i.getValueAt(m,1)-h.getValueAt(m,1)*a.getValueAt(m,m),p=-c.getValueAt(m,1)*j,q=o/2,r=q>=0?1:-1,s=q*q-n*p;if(s<0)throw new Error("Discriminant not positive during iteration "+k+", covariance matrix might not be definite positive");var t=-(q+r*Math.sqrt(s)),u=t/n,v=p/t,w=u>0?u:v;h.setValueAt(m,1,w),i=b.product(a,h),j=Math.sqrt(b.vectorDotProduct(i,h));var x=h.getValueAt(m,1)*i.getValueAt(m,1)/j;Math.abs(x-c.getValueAt(m,1))>e&&(l=!1)}if(++k,k>f)throw new Error("maximum number of iterations reached: "+f)}return h=h.normalize(),h.toArray()},a.roundedWeights=function(a,b){return r(a,b)},a}(PortfolioAllocation||{}),"undefined"!=typeof module&&(module.exports=PortfolioAllocation);